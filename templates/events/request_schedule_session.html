{% extends "events/create_base.html" %}

{% load i18n account guardian_tags wagtailcore_tags %}

{% block title %}
    Schedule a session for {{ hosted_session.title }}
{% endblock title %}

{% block form_title %}
    {% blocktrans with ft=hosted_session.title %}Schedule a session for {{ ft }}{% endblocktrans %}
{% endblock form_title %}

{% block form %}
    {% get_obj_perms request.user for hosted_session as "session_perms" %}
    {% if user.is_authenticated and "request_session" in session_perms %}
        {% if available_slots %}
            <form method="post" class="w-full pb-8">
                {% csrf_token %}
                {{ form.starts_at }}
                {{ form.ends_at }}
                <div class="flex flex-col gap-8 w-full mx-auto xl:w-3/4">
                    <div class="create_session__field_item">
                        <div class="flex flex-wrap w-full">
                            <label for="{{ form.language.id_for_label }}" class="text-2xl w-1/2">
                                {{ form.language.label }}
                                {% if form.language.required %}*{% endif %}
                            </label>
                            {{ form.language }}
                            <p class="create_session__field_item_help_text w-full font-subheading font-light">{{ form.language.help_text }}</p>
                        </div>
                        {{ form.language.errors }}
                    </div>
                    <div class="create_session__field_item">
                        <div class="flex flex-wrap">
                            {% if form.pay_concessionary_price.id_for_label %}
                                <label for="{{ form.pay_concessionary_price.id_for_label }}"
                                       class="text-2xl">{{ form.pay_concessionary_price.label }}</label>
                            {% else %}
                                <label for="id_{{ form.pay_concessionary_price.name }}_0" class="text-2xl">
                                    {{ form.pay_concessionary_price.label }}
                                </label>
                            {% endif %}
                            {{ form.pay_concessionary_price }}
                            <p class="create_session__field_item_help_text w-full font-subheading font-light">
                                {{ form.pay_concessionary_price.help_text }}
                            </p>
                        </div>
                        {{ form.pay_concessionary_price.errors }}
                    </div>
                    {% if hosted_session.host.profile.terms_and_conditions %}
                        <div class="create_session__field_item">
                            <div class="flex flex-col gap-4 p-6 bg-lightAccent rounded">
                                <h3 class="text-xl font-bold">{% trans "Host's Terms and Conditions" %}</h3>
                                <div class="prose max-w-none whitespace-pre-wrap">{{ hosted_session.host.profile.terms_and_conditions }}</div>
                            </div>
                            <div class="flex items-start gap-3 mt-4">
                                {{ form.accept_terms }}
                                <label for="{{ form.accept_terms.id_for_label }}"
                                       class="text-base cursor-pointer">
                                    {{ form.accept_terms.label }}
                                    {% if form.accept_terms.required %}<span class="text-red-600">*</span>{% endif %}
                                </label>
                            </div>
                            {{ form.accept_terms.errors }}
                        </div>
                    {% endif %}
                    {% with starts_at_id=form.starts_at.id_for_label ends_at_id=form.ends_at.id_for_label %}
                        {% request_calendar available_slots=available_slots durations=hosted_session.durations / %}
                    {% endwith %}
                    <button type="submit"
                            class="auth_button auth_button__sessions block mt-8 mx-auto text-center"
                            name="_preview"
                            value="_preview">{% trans "Preview request" %}</button>
                </div>
            </form>
        {% else %}
            <a href="{% pageurl page %}">{% trans "This session is all booked up. Head back to sessions." %}</a>
        {% endif %}
    {% else %}
        <p>
            <a href="{% url 'account_login' %}">{% trans "Oops, you're on the wrong page. Log in to continue." %}</a>
        </p>
    {% endif %}
{% endblock form %}
