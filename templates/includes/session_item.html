{% load i18n l10n heroicons wagtailcore_tags %}
<a href="{{ session.url }}" aria-label="{{ session.title }}">
    <article class="session_item {% if session.type == 'group' %}session_item--alt{% endif %}"
             tabindex="0">
        {# Header with date/time #}
        {% if session.type == 'group' %}
            {% if session.starts_at %}
                <div class="session_item__meta">
                    <time datetime="{{ session.starts_at|date:'c' }}"
                          class="session_item__date">
                        {% localize on %}{{ session.starts_at|date:"D, M j" }}{% endlocalize %}
                    </time>
                    <span class="session_item__separator" aria-hidden="true">â€¢</span>
                    <span class="session_item__time">{% localize on %}{{ session.starts_at|time:"g:i A" }}{% endlocalize %} - {% localize on %}{{ session.ends_at|time:"g:i A" }}{% endlocalize %}</span>
                    {% if session.recurring %}
                        <span class="session_item__badge session_item__badge--recurring">
                            {% heroicon_mini "arrow-path" size=12 %}
                            {% trans "Recurring" %}
                        </span>
                    {% endif %}
                </div>
            {% else %}
                <div class="session_item__meta-spacer" aria-hidden="true"></div>
            {% endif %}
        {% else %}
            <div class="session_item__meta-spacer" aria-hidden="true"></div>
        {% endif %}
        {# Title - primary heading #}
        <h2 class="session_item__title">{{ session.title }}</h2>
        {# Request status tag #}
        {% if session.request_status %}
            <span class="session_item__status session_item__status--{{ session.request_status }}">
                {% if session.request_status == "going" %}
                    {% heroicon_mini "check-circle" size=12 %}
                    {% trans "Going" %}
                {% elif session.request_status == "pending" %}
                    {% heroicon_mini "clock" size=12 %}
                    {% trans "Pending" %}
                {% elif session.request_status == "rejected" %}
                    {% heroicon_mini "x-circle" size=12 %}
                    {% trans "Not approved" %}
                {% endif %}
            </span>
        {% endif %}
        {# Description snippet - body text #}
        {% if session.description %}<p class="session_item__description">{{ session.description }}</p>{% endif %}
        {# Host - subheading #}
        <p class="session_item__author">{% trans "Hosted by" %} {{ session.host }}</p>
        {# Session details row #}
        <div class="session_item__details">
            {% if session.type == 'group' %}
                {# Language #}
                {% if session.language_display %}
                    <span class="session_item__tag">
                        {% heroicon_mini "language" size=14 %}
                        {{ session.language_display }}
                    </span>
                {% endif %}
                {# Remaining capacity #}
                <span class="session_item__tag {% if session.remaining_capacity > 0 %}session_item__tag--available{% else %}session_item__tag--full{% endif %}">
                    {% heroicon_mini "users" size=14 %}
                    {% if session.remaining_capacity > 0 %}
                        {% blocktrans with spots=session.remaining_capacity %}{{ spots }} spots left{% endblocktrans %}
                    {% else %}
                        {% trans "Full" %}
                    {% endif %}
                </span>
            {% else %}
                {# Peer session: languages #}
                {% if session.languages %}
                    <span class="session_item__tag">
                        {% heroicon_mini "language" size=14 %}
                        {% for lang in session.languages|slice:":2" %}
                            {{ lang }}
                            {% if not forloop.last %},{% endif %}
                        {% endfor %}
                        {% if session.languages|length > 2 %}+{{ session.languages|length|add:"-2" }}{% endif %}
                    </span>
                {% endif %}
                {# Peer session: durations #}
                {% if session.durations %}
                    <span class="session_item__tag">
                        {% heroicon_mini "clock" size=14 %}
                        {% blocktrans with start=session.durations|first end=session.durations|last %}
                            From {{ start }} to {{ end }}
                        {% endblocktrans %}
                    </span>
                {% endif %}
            {% endif %}
        </div>
        {# Filters/tags #}
        {% if session.filters %}
            <div class="session_item__filters">
                {% for group_slug, group_data in session.filters.items %}
                    {% for item_slug, item_data in group_data.items.items %}
                        <span class="session_item__filter-tag">{{ item_data.label }}</span>
                    {% endfor %}
                {% endfor %}
            </div>
        {% endif %}
        {# Arrow icon #}
        <div class="session_item__arrow">{% heroicon_solid "chevron-right" size=24 %}</div>
    </article>
</a>
